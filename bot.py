import os
import re
from datetime import datetime
from telegram import Update
from telegram.ext import Application, CommandHandler, MessageHandler, filters, ContextTypes

# –î–∞–Ω–Ω—ã–µ –æ —á–∏—Å–ª–∞—Ö –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏
LIFE_PATH_NUMBERS = {
    1: {
        "title": "1 - –ü–ï–†–í–û–ü–†–û–•–û–î–ï–¶",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å –ª–∏–¥–µ—Ä–∞. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ –¥–æ—Ä–æ–≥–∞, –∫–æ—Ç–æ—Ä—É—é –≤—ã –ø—Ä–æ–∫–ª–∞–¥—ã–≤–∞–µ—Ç–µ —Å–∞–º–∏. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è –∏–¥—Ç–∏ –ø–µ—Ä–≤—ã–º, –Ω–µ—Å—Ç–∏ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–≤–æ–∏ —Ä–µ—à–µ–Ω–∏—è, —Å—Ç–∞—Ç—å –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º –∏ —É–≤–µ—Ä–µ–Ω–Ω—ã–º –≤ —Å–µ–±–µ. –ò–∑–±–µ–≥–∞–π—Ç–µ —á—Ä–µ–∑–º–µ—Ä–Ω–æ–≥–æ —ç–≥–æ–∏–∑–º–∞ –∏ —É–ø—Ä—è–º—Å—Ç–≤–∞.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –°–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω—ã–π, –∞–º–±–∏—Ü–∏–æ–∑–Ω—ã–π, —Ä–µ—à–∏—Ç–µ–ª—å–Ω—ã–π. –í—ã —Ä–æ–∂–¥–µ–Ω—ã, —á—Ç–æ–±—ã –≤–µ—Å—Ç–∏ –∑–∞ —Å–æ–±–æ–π, –∞ –Ω–µ —Å–ª–µ–¥–æ–≤–∞—Ç—å. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤–µ –∏ —É–º–µ–Ω–∏–∏ –Ω–∞—á–∏–Ω–∞—Ç—å –Ω–æ–≤–æ–µ."
    },
    2: {
        "title": "2 - –î–ò–ü–õ–û–ú–ê–¢",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å —Å–æ—é–∑–∞. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ –º–æ—Å—Ç –º–µ–∂–¥—É –ª—é–¥—å–º–∏, –∏–¥–µ—è–º–∏ –∏ –º–∏—Ä–∞–º–∏. –í—ã –∑–¥–µ—Å—å, —á—Ç–æ–±—ã —Å–æ—Ç—Ä—É–¥–Ω–∏—á–∞—Ç—å, —Å–≥–ª–∞–∂–∏–≤–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç—ã, —Å–ª—É—à–∞—Ç—å –∏ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å. –ì–ª–∞–≤–Ω—ã–π –≤—ã–∑–æ–≤ ‚Äî –æ–±—Ä–µ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –≥–∞—Ä–º–æ–Ω–∏—é –∏ –Ω–µ —Ç–µ—Ä—è—Ç—å —Å–µ–±—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö —Å –¥—Ä—É–≥–∏–º–∏.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –ß—É—Ç–∫–∏–π, —Ç–∞–∫—Ç–∏—á–Ω—ã–π, —Ç–µ—Ä–ø–µ–ª–∏–≤—ã–π. –í—ã ‚Äî –∫–æ–º–∞–Ω–¥–Ω—ã–π –∏–≥—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –¥–æ–±–∏–≤–∞–µ—Ç—Å—è —É—Å–ø–µ—Ö–∞ —á–µ—Ä–µ–∑ –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ —É–º–µ–Ω–∏–∏ –¥–æ–≥–æ–≤–∞—Ä–∏–≤–∞—Ç—å—Å—è –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—é."
    },
    3: {
        "title": "3 - –¢–í–û–†–ï–¶",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏—è. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ —è—Ä–∫–æ–µ –ø–æ–ª–æ—Ç–Ω–æ, –∫–æ—Ç–æ—Ä–æ–µ –≤—ã —Ä–∞—Å–∫—Ä–∞—à–∏–≤–∞–µ—Ç–µ –∫—Ä–∞—Å–∫–∞–º–∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞, –æ–±—â–µ–Ω–∏—è –∏ —Ä–∞–¥–æ—Å—Ç–∏. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –≤–¥–æ—Ö–Ω–æ–≤–ª—è—Ç—å –¥—Ä—É–≥–∏—Ö, –¥–µ–ª–∏—Ç—å—Å—è —Å–≤–æ–∏–º –æ–ø—Ç–∏–º–∏–∑–º–æ–º –∏ –Ω–µ—Å—Ç–∏ –≤ –º–∏—Ä –∫—Ä–∞—Å–æ—Ç—É. –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä–∞—Å–ø—ã–ª–µ–Ω–∏—è —Ç–∞–ª–∞–Ω—Ç–æ–≤.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –û–±—â–∏—Ç–µ–ª—å–Ω—ã–π, –∞—Ä—Ç–∏—Å—Ç–∏—á–Ω—ã–π, –∂–∏–∑–Ω–µ—Ä–∞–¥–æ—Å—Ç–Ω—ã–π. –í—ã –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç–µ –ª—é–¥–µ–π —Å–≤–æ–∏–º —ç–Ω—Ç—É–∑–∏–∞–∑–º–æ–º. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ —Å–ª–æ–≤–µ, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–µ –∏ —É–º–µ–Ω–∏–∏ –≤–∏–¥–µ—Ç—å —Ä–∞–¥–æ—Å—Ç—å –≤ –º–µ–ª–æ—á–∞—Ö."
    },
    4: {
        "title": "4 - –°–¢–†–û–ò–¢–ï–õ–¨",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å –ø–æ—Ä—è–¥–∫–∞. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ –ø—Ä–æ—á–Ω—ã–π –¥–æ–º, –∫–æ—Ç–æ—Ä—ã–π –Ω—É–∂–Ω–æ –≤–æ–∑–≤–µ—Å—Ç–∏ –ø–æ –≤—Å–µ–º –ø—Ä–∞–≤–∏–ª–∞–º, –∫–∏—Ä–ø–∏—á–∏–∫ –∑–∞ –∫–∏—Ä–ø–∏—á–∏–∫–æ–º. –í—ã –∑–¥–µ—Å—å, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞–≤–∞—Ç—å —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, —Ä–∞–±–æ—Ç–∞—Ç—å —É–ø–æ—Ä–Ω–æ –∏ –Ω–µ—Å—Ç–∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å. –ì–ª–∞–≤–Ω—ã–π –≤—ã–∑–æ–≤ ‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è –≥–∏–±–∫–æ—Å—Ç–∏ –≤–Ω—É—Ç—Ä–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö —Ä–∞–º–æ–∫.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –ü—Ä–∞–∫—Ç–∏—á–Ω—ã–π, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π, –Ω–∞–¥–µ–∂–Ω—ã–π. –í—ã ‚Äî —á–µ–ª–æ–≤–µ–∫ —Å–∏—Å—Ç–µ–º—ã –∏ —á–µ—Å—Ç–Ω–æ–≥–æ —Ç—Ä—É–¥–∞. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ —Ç–µ—Ä–ø–µ–Ω–∏–∏, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –∏–¥–µ–∏ –≤ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—É—é —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å."
    },
    5: {
        "title": "5 - –°–í–û–ë–û–î–ù–´–ô –î–£–•",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å –ø–µ—Ä–µ–º–µ–Ω. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ –Ω–µ—Å–∫–æ–Ω—á–∞–µ–º–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ, –ø–æ–ª–Ω–æ–µ –Ω–æ–≤—ã—Ö –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–π, –ª—é–¥–µ–π –∏ —Å–≤–æ–±–æ–¥—ã. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞–±—Ä–∞—Ç—å—Å—è —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–≥–æ –æ–ø—ã—Ç–∞, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å—Å—è –∫ –ª—é–±—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º –∏ –Ω–∞—É—á–∏—Ç—å—Å—è –Ω–∞–ø—Ä–∞–≤–ª—è—Ç—å —Å–≤–æ—é —ç–Ω–µ—Ä–≥–∏—é –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–∏–≤–Ω–æ–µ —Ä—É—Å–ª–æ. –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä–∞–∑–±—Ä–æ—Å–∞–Ω–Ω–æ—Å—Ç–∏.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –ù–µ—É–≥–æ–º–æ–Ω–Ω—ã–π, –ª—é–±–æ–∑–Ω–∞—Ç–µ–ª—å–Ω—ã–π, –ø—Ä–æ–≥—Ä–µ—Å—Å–∏–≤–Ω—ã–π. –í—ã –Ω–µ–Ω–∞–≤–∏–¥–∏—Ç–µ —Ä—É—Ç–∏–Ω—É –∏ –æ–±–æ–∂–∞–µ—Ç–µ –≤—Å–µ –Ω–æ–≤–æ–µ. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç–∏, –æ–±–∞—è–Ω–∏–∏ –∏ —É–º–µ–Ω–∏–∏ –Ω–∞—Å–ª–∞–∂–¥–∞—Ç—å—Å—è –∂–∏–∑–Ω—å—é –≤–æ –≤—Å–µ–º –µ–µ –º–Ω–æ–≥–æ–æ–±—Ä–∞–∑–∏–∏."
    },
    6: {
        "title": "6 - –û–ü–ï–ö–£–ù",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å —Å–ª—É–∂–µ–Ω–∏—è. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ —É—é—Ç–Ω—ã–π –¥–æ–º, –∑–∞ –∫–æ—Ç–æ—Ä—ã–π –≤—ã –≤ –æ—Ç–≤–µ—Ç–µ. –í—ã –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –∑–∞–±–æ—Ç–∏—Ç—å—Å—è –æ –¥—Ä—É–≥–∏—Ö (—Å–µ–º—å–µ, –±–ª–∏–∑–∫–∏—Ö, –æ–±—â–µ—Å—Ç–≤–µ), —Å–æ–∑–¥–∞–≤–∞—Ç—å –≥–∞—Ä–º–æ–Ω–∏—é, –∫—Ä–∞—Å–æ—Ç—É –∏ –±—Ä–∞—Ç—å –Ω–∞ —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å. –ì–ª–∞–≤–Ω—ã–π –≤—ã–∑–æ–≤ ‚Äî –Ω–µ –±—Ä–∞—Ç—å –Ω–∞ —Å–µ–±—è —Ä–æ–ª—å ¬´—Å–ø–∞—Å–∏—Ç–µ–ª—è¬ª –∏ –Ω–µ –∑–∞–±—ã–≤–∞—Ç—å –æ —Å–µ–±–µ.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –ó–∞–±–æ—Ç–ª–∏–≤—ã–π, –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π, –ª—é–±—è—â–∏–π. –í—ã ‚Äî –ø—Ä–∏—Ä–æ–∂–¥–µ–Ω–Ω—ã–π —Ä–æ–¥–∏—Ç–µ–ª—å –∏ —Å–æ–≤–µ—Ç—á–∏–∫. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ —á—É–≤—Å—Ç–≤–µ –¥–æ–ª–≥–∞, —ç—Å—Ç–µ—Ç–∏—á–µ—Å–∫–æ–º –≤–∫—É—Å–µ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –∏—Å—Ü–µ–ª—è—Ç—å –¥—É—à–∏."
    },
    7: {
        "title": "7 - –ò–°–°–õ–ï–î–û–í–ê–¢–ï–õ–¨",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å –ø–æ–∑–Ω–∞–Ω–∏—è. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ –≥–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, –ø–æ–∏—Å–∫ —Å–∫—Ä—ã—Ç—ã—Ö –∏—Å—Ç–∏–Ω –∏ –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –≥–ª–∞–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã. –í—ã –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å, —Ä–∞–∑–º—ã—à–ª—è—Ç—å, —Ä–∞–∑–≤–∏–≤–∞—Ç—å –∏–Ω—Ç—É–∏—Ü–∏—é –∏ –Ω–∞—Ö–æ–¥–∏—Ç—å –º—É–¥—Ä–æ—Å—Ç—å –≤ —É–µ–¥–∏–Ω–µ–Ω–∏–∏. –ò–∑–±–µ–≥–∞–π—Ç–µ –∏–∑–ª–∏—à–Ω–µ–π –∑–∞–º–∫–Ω—É—Ç–æ—Å—Ç–∏ –∏ —Å–∫–µ–ø—Ç–∏—Ü–∏–∑–º–∞.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –ê–Ω–∞–ª–∏—Ç–∏—á–Ω—ã–π, –¥—É—Ö–æ–≤–Ω—ã–π, –∏–Ω—Ç—Ä–æ–≤–µ—Ä—Ç–Ω—ã–π. –í—ã –¥–æ–≤–µ—Ä—è–µ—Ç–µ —Ñ–∞–∫—Ç–∞–º –∏ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–º—É –≥–æ–ª–æ—Å—É –±–æ–ª—å—à–µ, —á–µ–º —á—É–∂–∏–º —Å–ª–æ–≤–∞–º. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ –ø—Ä–æ–Ω–∏—Ü–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, –ª—é–±–≤–∏ –∫ –∑–Ω–∞–Ω–∏—è–º –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –≤–∏–¥–µ—Ç—å —Å—É—Ç—å –≤–µ—â–µ–π."
    },
    8: {
        "title": "8 - –°–¢–†–ê–¢–ï–ì",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å –∏–∑–æ–±–∏–ª–∏—è. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ –∏–≥—Ä–∞ –±–æ–ª—å—à–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∞, –≥–¥–µ –≤—ã —É—á–∏—Ç–µ—Å—å —É–ø—Ä–∞–≤–ª—è—Ç—å —ç–Ω–µ—Ä–≥–∏–µ–π –¥–µ–Ω–µ–≥, –≤–ª–∞—Å—Ç–∏ –∏ —É—Å–ø–µ—Ö–∞. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –Ω–∞—É—á–∏—Ç—å—Å—è –±–∞–ª–∞–Ω—Å—É –º–µ–∂–¥—É –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω—ã–º –∏ –¥—É—Ö–æ–≤–Ω—ã–º, —É–ø—Ä–∞–≤–ª—è—Ç—å —Ä–µ—Å—É—Ä—Å–∞–º–∏ –º—É–¥—Ä–æ –∏ —Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤–æ. –ì–ª–∞–≤–Ω—ã–π –≤—ã–∑–æ–≤ ‚Äî –Ω–µ –¥–µ–ª–∞—Ç—å –¥–µ–Ω—å–≥–∏ —Å–∞–º–æ—Ü–µ–ª—å—é.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –¶–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω—ã–π, –∞–≤—Ç–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π, –≤–æ–ª–µ–≤–æ–π. –í—ã —Ä–æ–∂–¥–µ–Ω—ã, —á—Ç–æ–±—ã —Ä—É–∫–æ–≤–æ–¥–∏—Ç—å –∏ –¥–æ—Å—Ç–∏–≥–∞—Ç—å –±–æ–ª—å—à–∏—Ö —Ü–µ–ª–µ–π –≤ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–º –º–∏—Ä–µ. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä—Å–∫–∏—Ö —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—è—Ö, –¥–∞–ª—å–Ω–æ–≤–∏–¥–Ω–æ—Å—Ç–∏ –∏ —É–º–µ–Ω–∏–∏ –≤–æ–ø–ª–æ—â–∞—Ç—å –∏–¥–µ–∏ –≤ –º–æ—â–Ω—ã–µ –ø—Ä–æ–µ–∫—Ç—ã."
    },
    9: {
        "title": "9 - –ì–£–ú–ê–ù–ò–°–¢",
        "life": "–ñ–∏–∑–Ω—å: –ü—É—Ç—å —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏—è. –í–∞—à–∞ –∂–∏–∑–Ω—å ‚Äî —ç—Ç–æ —É—Ä–æ–∫ –≤—Å–µ–æ–±—â–µ–π –ª—é–±–≤–∏ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ü–∏–∫–ª–æ–≤. –í—ã –∑–¥–µ—Å—å, —á—Ç–æ–±—ã –æ—Ç–ø—É—Å–∫–∞—Ç—å —Å—Ç–∞—Ä–æ–µ, —Å–ª—É–∂–∏—Ç—å —á–µ–ª–æ–≤–µ—á–µ—Å—Ç–≤—É –Ω–∞ —à–∏—Ä–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ, –ø—Ä–æ—â–∞—Ç—å –∏ –ø—Ä–æ—è–≤–ª—è—Ç—å –º–∏–ª–æ—Å–µ—Ä–¥–∏–µ. –í–∞—à–∞ –∑–∞–¥–∞—á–∞ ‚Äî –∑–∞–≤–µ—Ä—à–∏—Ç—å –¥–µ–ª–∞ –∏ –æ—Å—Ç–∞–≤–∏—Ç—å –ø–æ—Å–ª–µ —Å–µ–±—è –¥–æ–±—Ä—ã–π —Å–ª–µ–¥.",
        "person": "–ß–µ–ª–æ–≤–µ–∫: –û—Ç–∑—ã–≤—á–∏–≤—ã–π, –º—É–¥—Ä—ã–π, –±–µ—Å–∫–æ—Ä—ã—Å—Ç–Ω—ã–π. –í—ã –æ–±–ª–∞–¥–∞–µ—Ç–µ —à–∏—Ä–æ–∫–∏–º –∫—Ä—É–≥–æ–∑–æ—Ä–æ–º –∏ —á–∞—Å—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç–µ—Å—å ¬´–ø–æ—Å–ª–µ–¥–Ω–µ–π –∏–Ω—Å—Ç–∞–Ω—Ü–∏–µ–π¬ª. –í–∞—à–∞ —Å–∏–ª–∞ ‚Äî –≤ —Å–æ—Å—Ç—Ä–∞–¥–∞–Ω–∏–∏, —Ç–µ—Ä–ø–∏–º–æ—Å—Ç–∏ –∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ª—é–±–∏—Ç—å –º–Ω–æ–≥–∏—Ö."
    }
}


def calculate_life_path_number(date_str: str) -> tuple:
    """–í—ã—á–∏—Å–ª—è–µ—Ç —á–∏—Å–ª–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏ –∏–∑ –¥–∞—Ç—ã —Ä–æ–∂–¥–µ–Ω–∏—è"""
    try:
        # –ü–∞—Ä—Å–∏–º –¥–∞—Ç—É
        date_obj = datetime.strptime(date_str, "%d.%m.%Y")
        day = date_obj.day
        month = date_obj.month
        year = date_obj.year

        # –°–∫–ª–∞–¥—ã–≤–∞–µ–º –≤—Å–µ —Ü–∏—Ñ—Ä—ã
        total = sum(int(digit) for digit in str(day) + str(month) + str(year))

        # –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–≤–æ—Ä–∞—á–∏–≤–∞—Ç—å –¥–æ –æ–¥–Ω–æ–∑–Ω–∞—á–Ω–æ–≥–æ —á–∏—Å–ª–∞
        calculation_steps = [f"–°–∫–ª–∞–¥—ã–≤–∞–µ–º: {' + '.join(str(day) + ' + ' + str(month) + ' + ' + str(year))} = {total}"]

        while total > 9:
            digits = [int(d) for d in str(total)]
            new_total = sum(digits)
            calculation_steps.append(f"–°–≤–æ—Ä–∞—á–∏–≤–∞–µ–º –µ—â–µ —Ä–∞–∑: {' + '.join(str(d) for d in digits)} = {new_total}")
            total = new_total

        return total, calculation_steps
    except ValueError:
        return None, []


async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–æ–º–∞–Ω–¥—ã /start"""
    welcome_text = (
        "<b>–ü—Ä–∏–≤–µ—Ç! –Ø —Ç–µ–ª–µ–≥—Ä–∞–º–º-–±–æ—Ç ¬´–ü—É—Ç–µ–≤–æ–¥–Ω–æ–µ –ß–∏—Å–ª–æ¬ªüîÆ</b>\n"
        "<b>–¢—ã —Ö–æ—á–µ—à—å —É–∑–Ω–∞—Ç—å, —á—Ç–æ —Å–∫–∞–∂—É—Ç –∑–≤–µ–∑–¥—ã? üå†</b>\n\n"
        "–ê —è —Ä–∞—Å—Å–∫–∞–∂—É —Ç–æ, —á—Ç–æ –∑–Ω–∞—é—Ç —á–∏—Å–ª–∞! –Ø –ø–æ–º–æ–≥—É —Ç–µ–±–µ —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ç–≤–æ–µ <b>–ß–∏—Å–ª–æ –ñ–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ü—É—Ç–∏</b> ‚Äî —Å–∞–∫—Ä–∞–ª—å–Ω—ã–π –∫–æ–¥ —Ç–≤–æ–µ–π —Å—É–¥—å–±—ã.\n\n"
        "–ü—Ä–æ—Å—Ç–æ <b>–≤–≤–µ–¥–∏ —Å–≤–æ—é –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì</b>\n"
        "(–Ω–∞–ø—Ä–∏–º–µ—Ä, 01.01.2000), –∏ —è —Ä–∞—Å–∫—Ä–æ—é –µ–≥–æ –∑–Ω–∞—á–µ–Ω–∏–µ.\n\n"
        "–í–ø–µ—Ä–µ–¥, –∫ –ø–æ–∑–Ω–∞–Ω–∏—é —Å–µ–±—è! ‚ú®"
    )

    await update.message.reply_text(welcome_text, parse_mode='HTML')
    context.user_data['awaiting_date'] = True


async def handle_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π"""
    user_message = update.message.text.strip()

    # –ü—Ä–æ–≤–µ—Ä—è–µ–º, –æ–∂–∏–¥–∞–µ–º –ª–∏ –º—ã –¥–∞—Ç—É
    if context.user_data.get('awaiting_date', False):
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã
        date_pattern = r'^\d{2}\.\d{2}\.\d{4}$'
        if re.match(date_pattern, user_message):
            # –í—ã—á–∏—Å–ª—è–µ–º —á–∏—Å–ª–æ –∂–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ø—É—Ç–∏
            life_path_number, steps = calculate_life_path_number(user_message)

            if life_path_number:
                # –ü–æ–ª—É—á–∞–µ–º –æ–ø–∏—Å–∞–Ω–∏–µ —á–∏—Å–ª–∞
                number_info = LIFE_PATH_NUMBERS.get(life_path_number)

                if number_info:
                    response_text = (
                        "üîÆ<b>–¢–≤–æ–µ –ø–æ—Å–ª–∞–Ω–∏–µ –æ—Ç —á–∏—Å–µ–ª</b>üîÆ\n\n"
                        f"üìÖ <b>–î–∞—Ç–∞:</b> {user_message}\n"
                        f"üî¢ <b>–ß–∏—Å–ª–æ –ñ–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ü—É—Ç–∏:</b> #{life_path_number}\n\n"
                        f"<b>–û–ª–∏—Ü–µ—Ç–≤–æ—Ä–µ–Ω–∏–µ:</b> {number_info['title']}\n\n"
                        f"<b>–ñ–∏–∑–Ω—å:</b> {number_info['life'].replace('–ñ–∏–∑–Ω—å: ', '')}\n\n"
                        f"<b>–ß–µ–ª–æ–≤–µ–∫:</b> {number_info['person'].replace('–ß–µ–ª–æ–≤–µ–∫: ', '')}\n\n"
                        f"üëã –≠—Ç–æ —á–∏—Å–ª–æ ‚Äî —Ç–≤–æ–π –∫–ª—é—á. –•—Ä–∞–Ω–∏ –µ–≥–æ!"
                    )

                    await update.message.reply_text(response_text, parse_mode='HTML')
                    context.user_data['awaiting_date'] = False
                else:
                    await update.message.reply_text("–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —á–∏—Å–ª–µ.")
            else:
                await update.message.reply_text(
                    "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã!\n\n"
                    "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì\n"
                    "–ù–∞–ø—Ä–∏–º–µ—Ä: 17.08.1994"
                )
        else:
            await update.message.reply_text(
                "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –¥–∞—Ç—ã!\n\n"
                "–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì\n"
                "–ù–∞–ø—Ä–∏–º–µ—Ä: 17.08.1994"
            )
    else:
        # –ï—Å–ª–∏ –Ω–µ –æ–∂–∏–¥–∞–µ–º –¥–∞—Ç—É, –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –Ω–∞—á–∞—Ç—å
        await update.message.reply_text(
            "–ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å–≤–æ–µ –ß–∏—Å–ª–æ –ñ–∏–∑–Ω–µ–Ω–Ω–æ–≥–æ –ü—É—Ç–∏, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É /start"
        )


def main():
    """–ó–∞–ø—É—Å–∫ –±–æ—Ç–∞"""
    # –ü–æ–ª—É—á–∞–µ–º —Ç–æ–∫–µ–Ω –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ–∫—Ä—É–∂–µ–Ω–∏—è
    token = os.getenv('BOT_TOKEN')

    if not token:
        print("‚ùå –û—à–∏–±–∫–∞: –Ω–µ –Ω–∞–π–¥–µ–Ω BOT_TOKEN –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è!")
        return

    # –°–æ–∑–¥–∞–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
    application = Application.builder().token(token).build()

    # –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
    application.add_handler(CommandHandler("start", start))
    application.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, handle_message))

    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞
    print("ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω!")
    application.run_polling(allowed_updates=Update.ALL_TYPES)


if __name__ == '__main__':
    main()